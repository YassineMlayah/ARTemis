<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Shopping Cart</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      /* Reuse styles from all_products.html */
      body {
        margin: 0;
        background-color: white;
        color: black;
        font-family: "Playfair Display", serif;
      }

      .container {
        max-width: 90%;
        margin-top: 30px;
      }

      .cards-container {
        margin-top: 20px;
      }

      .card {
        border: none;
        border-radius: 15px;
        overflow: hidden;
        transition: all 0.3s ease;
        margin-bottom: 30px;
        background-color: #f8f9fa;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        cursor: pointer;
      }

      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
      }

      .card-img-top {
        height: 280px;
        object-fit: cover;
        border-bottom: 2px solid rgb(219, 206, 131);
      }

      .card-body {
        padding: 20px;
        background-color: rgb(219, 206, 131);
      }

      .card-body textarea {
        border: none;
        background-color: transparent;
        resize: none;
        overflow: hidden;
        font-size: 18px;
        font-weight: bold;
        font-family: "Playfair Display", serif;
        color: black;
        width: 100%;
        height: auto;
        padding: 0;
        margin: 0;
      }

      .card-body textarea:focus {
        outline: none;
      }

      .btn-custom {
        background-color: black;
        color: rgb(247, 246, 244);
        border: none;
      }

      .btn-custom:hover {
        background-color: rgb(50, 50, 50);
        color: rgb(219, 206, 131);
      }
    </style>
  </head>
  <body>
    <!-- Header from index.html -->
    <header style="background-color: black; padding: 20px 50px">
      <div class="d-flex justify-content-between align-items-center">
        <div class="d-flex align-items-center">
          <img
            src="./images/image.png"
            class="log-icone"
            alt="Logo"
            style="width: 60px; height: 60px; margin-right: 10px"
          />
          <h1 style="color: rgb(207, 187, 121); font-size: 28px; margin: 0">
            <span style="color: white">ART</span>emis
          </h1>
        </div>
        <nav>
          <ul
            class="d-flex gap-4"
            style="list-style: none; margin: 0; padding: 0"
          >
            <li>
              <a
                href="/"
                style="color: white; text-decoration: none; font-size: 16px"
                >Home</a
              >
            </li>
            <li>
              <a
                href="/contact"
                style="color: white; text-decoration: none; font-size: 16px"
                >Contact</a
              >
            </li>
            <li>
              <a
                href="/aboutus"
                style="color: white; text-decoration: none; font-size: 16px"
                >About</a
              >
            </li>
            <li>
              <a
                href="/cart"
                style="color: white; text-decoration: none; font-size: 16px"
                >Cart</a
              >
            </li>
          </ul>
        </nav>
        <div class="d-flex align-items-center gap-3">
          <a
            href="/login"
            style="color: white; text-decoration: none; font-size: 16px"
            >Log in</a
          >
          <a href="/profile">
            <img
              src="https://as1.ftcdn.net/v2/jpg/02/09/95/42/500_F_209954204_mHCvAQBIXP7C2zRl5Fbs6MEWOEkaX3cA.jpg"
              alt="Profile"
              style="width: 40px; height: 40px; border-radius: 50%"
            />
          </a>
        </div>
      </div>
    </header>
    <hr style="border: 1px solid rgb(207, 187, 121); margin: 0" />
    <div class="container">
      <h2
        class="text-center"
        style="color: rgb(207, 187, 121); margin-bottom: 20px"
      >
        Your Shopping Cart
      </h2>
      <div class="d-flex justify-content-end mt-3">
        <button
          class="btn btn-lg btn-custom"
          style="
            background-color: rgb(219, 206, 131);
            color: black;
            border: none;
            font-size: 18px;
            font-weight: bold;
            padding: 10px 20px;
            cursor: not-allowed;
          "
          disabled
        >
          Checkout
        </button>
      </div>
      <div class="cards-container">
        <div class="row"></div>
      </div>
    </div>

    <!-- Product Modal -->
    <div
      class="modal fade"
      id="productModal"
      tabindex="-1"
      aria-labelledby="productModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div
            class="modal-header"
            style="background-color: rgb(219, 206, 131); color: black"
          >
            <h5 class="modal-title" id="productModalLabel">Product Details</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <div class="row">
              <div class="col-md-6">
                <img
                  id="productModalImage"
                  src=""
                  class="img-fluid rounded"
                  style="max-height: 400px; width: 100%; object-fit: cover"
                />
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="productModalDescription" class="form-label"
                    >Description</label
                  >
                  <textarea
                    id="productModalDescription"
                    class="form-control"
                    rows="3"
                    readonly
                  ></textarea>
                </div>
                <div class="mb-3">
                  <label for="productModalPrice" class="form-label"
                    >Price</label
                  >
                  <input
                    type="text"
                    id="productModalPrice"
                    class="form-control"
                    readonly
                  />
                </div>
                <div class="mb-3">
                  <label for="productModalAvailability" class="form-label"
                    >Availability</label
                  >
                  <input
                    type="text"
                    id="productModalAvailability"
                    class="form-control"
                    readonly
                  />
                </div>
                <div class="mb-3">
                  <label for="productModalCategory" class="form-label"
                    >Category</label
                  >
                  <input
                    type="text"
                    id="productModalCategory"
                    class="form-control"
                    readonly
                  />
                </div>
                <div class="mb-3">
                  <label for="productModalArtist" class="form-label"
                    >Artist</label
                  >
                  <input
                    type="text"
                    id="productModalArtist"
                    class="form-control"
                    readonly
                  />
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-danger"
              onclick="removeFromCart($('#productModal').data('productId'))"
            >
              Remove from Cart
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer
      style="
        background-color: black;
        color: white;
        padding: 40px 50px;
        margin-top: 50px;
      "
    >
      <div class="row">
        <div class="col-md-3">
          <h5 style="color: rgb(207, 187, 121)">Exclusive</h5>
          <p>Subscribe to get 10% off your first order</p>
          <input
            type="email"
            placeholder="Enter your email"
            style="width: 100%; padding: 8px; border: none; border-radius: 5px"
          />
        </div>
        <div class="col-md-3">
          <h5 style="color: rgb(207, 187, 121)">Support</h5>
          <p>FST, Campus Universitaire El-Manar, 2092 El Manar Tunis</p>
          <p>ARTemisSupport@exclusive.com</p>
          <p>+216 99 999 999</p>
        </div>
        <div class="col-md-3">
          <h5 style="color: rgb(207, 187, 121)">Account</h5>
          <ul style="list-style: none; padding: 0">
            <li>
              <a href="/profile" style="color: white; text-decoration: none"
                >My Account</a
              >
            </li>
            <li>
              <a href="/login" style="color: white; text-decoration: none"
                >Login / Register</a
              >
            </li>
            <li>
              <a href="/cart" style="color: white; text-decoration: none"
                >Cart</a
              >
            </li>
            <li>
              <a href="#" style="color: white; text-decoration: none"
                >Wishlist</a
              >
            </li>
            <li>
              <a href="#" style="color: white; text-decoration: none">Shop</a>
            </li>
          </ul>
        </div>
        <div class="col-md-3">
          <h5 style="color: rgb(207, 187, 121)">Quick Links</h5>
          <ul style="list-style: none; padding: 0">
            <li>
              <a href="#" style="color: white; text-decoration: none"
                >Privacy Policy</a
              >
            </li>
            <li>
              <a href="#" style="color: white; text-decoration: none"
                >Terms Of Use</a
              >
            </li>
            <li>
              <a href="#" style="color: white; text-decoration: none">FAQ</a>
            </li>
            <li>
              <a href="#" style="color: white; text-decoration: none"
                >Contact</a
              >
            </li>
          </ul>
        </div>
      </div>
      <div class="text-center" style="margin-top: 20px">
        <p>Sponsored by Twitter & Instagram</p>
        <div class="d-flex justify-content-center gap-3">
          <a href="#"
            ><img
              src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRj-X06O3ppyMhQotOP_Km27fpwe0FgZGqXiA&s"
              alt="Twitter"
              style="width: 30px; height: 30px"
          /></a>
          <a href="#"
            ><img
              src="https://cdn-icons-png.flaticon.com/512/5968/5968776.png"
              alt="Instagram"
              style="width: 30px; height: 30px"
          /></a>
        </div>
      </div>
    </footer>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      $(document).ready(function () {
        fetchCartItems();

        $(".cards-container").on("click", ".card", function () {
          const productId = $(this).data("product-id");
          fetchProductDetails(productId);
        });

        $(".cards-container").on("click", ".remove-btn", function (e) {
          e.stopPropagation(); // Prevent triggering the card click event
          const productId = $(this).data("product-id");
          removeFromCart(productId);
        });
      });

      function fetchCartItems() {
        $.ajax({
          url: "/api/cart/user/current",
          method: "GET",
          success: function (cart) {
            const container = $(".cards-container .row");
            container.empty();
            cart.items.forEach((product) => {
              const card = `
                <div class="col-md-4">
                  <div class="card" data-product-id="${product.productID}">
                    <img src="${product.imagePath}" class="card-img-top" alt="${product.name}" />
                    <div class="card-body">
                      <textarea readonly>${product.name}</textarea>
                      <div class="d-flex justify-content-between mt-2">
                        <span class="badge bg-dark">$${product.price}</span>
                        <button class="btn btn-danger btn-sm remove-btn" data-product-id="${product.productID}">Remove</button>
                      </div>
                    </div>
                  </div>
                </div>`;
              container.append(card);
            });
          },
          error: function (xhr, status, error) {
            console.error("Failed to fetch cart items:", error);
            alert("Failed to load cart items. Please try again later.");
          },
        });
      }

      function fetchProductDetails(productId) {
        $.ajax({
          url: `/api/product/${productId}`,
          method: "GET",
          success: function (product) {
            $("#productModal").data("productId", product.productID);
            $("#productModalImage").attr("src", product.imagePath);
            $("#productModalDescription").val(product.description);
            $("#productModalPrice").val(`$${product.price}`);
            $("#productModalAvailability").val(
              product.available ? "Available" : "Sold"
            );
            $("#productModalCategory").val(product.category.replace("_", " "));
            const fullName = `${product.artist.firstName} ${product.artist.lastName}`;
            $("#productModalArtist").val(fullName);

            // Update modal title with product name
            $("#productModalLabel").text(product.name);

            $("#productModal").modal("show");
          },
          error: function (xhr, status, error) {
            console.error("Failed to fetch product details:", error);
            alert("Failed to load product details. Please try again later.");
          },
        });
      }

      function removeFromCart(productId) {
        $.ajax({
          url: `/api/cart/remove?productId=${productId}`,
          method: "DELETE",
          success: function () {
            alert("Product removed from cart successfully!");
            fetchCartItems();
            $("#productModal").modal("hide"); // Close the modal after removing the item
          },
          error: function (xhr, status, error) {
            console.error("Failed to remove product from cart:", error);
            alert(
              "Failed to remove product from cart. Please try again later."
            );
          },
        });
      }
    </script>
  </body>
</html>
